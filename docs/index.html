<html>
<body>
    <table id="match" match="">
      <tr><span id="updates"></span></tr>
      <tr><td id="name1"><td><td id="name2"></td></tr>
      <tr><td id="set1"><td><td id="set2"></td></tr>
      <tr><td id="score1"><td><td id="score2"></td></tr>
    </table>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        function getUrlVars()  {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++)
            {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        const firebaseConfig = {
          "project_info": {
            "project_number": "473052494821",
            "firebase_url": "https://gp4e-6a225.firebaseio.com",
            "project_id": "gp4e-6a225",
            "storage_bucket": "gp4e-6a225.appspot.com"
          },
          "client": [
            {
              "client_info": {
                "mobilesdk_app_id": "1:473052494821:android:7922d01d93e98595680d0c",
                "android_client_info": {
                  "package_name": "com.gp4e.gp4e"
                }
              },
              "oauth_client": [
                {
                  "client_id": "473052494821-hl426pj4hiti0kjrokeqf277sg3mim8s.apps.googleusercontent.com",
                  "client_type": 3
                }
              ],
              "api_key": [
                {
                  "current_key": "AIzaSyCnyVeuMNfIEPrB4GFnU3gepf6FMRctrWw"
                }
              ],
              "services": {
                "appinvite_service": {
                  "other_platform_oauth_client": [
                    {
                      "client_id": "473052494821-hl426pj4hiti0kjrokeqf277sg3mim8s.apps.googleusercontent.com",
                      "client_type": 3
                    }
                  ]
                }
              }
            },
            {
              "client_info": {
                "mobilesdk_app_id": "1:473052494821:android:64ee41e68a62683f680d0c",
                "android_client_info": {
                  "package_name": "it.domipoke.pingpongscoreboard"
                }
              },
              "oauth_client": [
                {
                  "client_id": "473052494821-v5jokfsn75jvvcruhkl3u9lbotc6s7io.apps.googleusercontent.com",
                  "client_type": 1,
                  "android_info": {
                    "package_name": "it.domipoke.pingpongscoreboard",
                    "certificate_hash": "e74c47eef33eb4b6981c9cd026e69512b5c2dae9"
                  }
                },
                {
                  "client_id": "473052494821-hl426pj4hiti0kjrokeqf277sg3mim8s.apps.googleusercontent.com",
                  "client_type": 3
                }
              ],
              "api_key": [
                {
                  "current_key": "AIzaSyCnyVeuMNfIEPrB4GFnU3gepf6FMRctrWw"
                }
              ],
              "services": {
                "appinvite_service": {
                  "other_platform_oauth_client": [
                    {
                      "client_id": "473052494821-hl426pj4hiti0kjrokeqf277sg3mim8s.apps.googleusercontent.com",
                      "client_type": 3
                    }
                  ]
                }
              }
            }
          ],
          "configuration_version": "1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        var id=getUrlVars()["matchid"];
        db.collection("matches").doc(id).onSnapshot((doc) => {
            var data = doc.data()
            var sets = data["sets"]
            var w1 = sets.filter(x=>x.score1>x.score2).length
            var w2 = sets.filter(x=>x.score2>x.score1).length
            var pls = data["players"].length
            var team1="";
            var team2="";
            if (pls==2) {
                team1 = data["players"]["player1"]["name"]
                team2 = data["players"]["player2"]["name"]
            } else if (pls==4) {
                team1 = data["players"]["player1"]["name"]+" "+data["players"]["player3"]["name"]
                team2 = data["players"]["player2"]["name"]+" "+data["players"]["player4"]["name"]
            }
            document.getElementById("name1").innerHTML=team1
            document.getElementById("name2").innerHTML=team2

            document.getElementById("set1").innerHTML=w1
            document.getElementById("set2").innerHTML=w2

            document.getElementById("score1").innerHTML=data["score1"]
            document.getElementById("score2").innerHTML=data["score2"]
        });
    </script>
</body>
</html>

<html>
    <head>
        <link type="text/css" rel="stylesheet" href="./css/all.css">
        <link type="text/css" rel="stylesheet" href="./css/style.css">
        <link type="text/css" rel="stylesheet" href="./css/scrollbar.css">
        <link type="text/css" rel="stylesheet" href="./css/table.css">
    </head>
<body>
    <custom-menu></custom-menu>
    <table class="match" match="">
      <tr><span class="updates"></span></tr>
      <tr><td class="tag">Player: <span></span></td><td class="name1"><td><td class="name2"></td></tr>
      <tr><td class="tag">Set: <span></span></td><td class="set1"><td><td class="set2"></td></tr>
      <tr><td class="tag">Score: <span></span></td><td class="score1"><td><td class="score2"></td></tr>
    </table>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="./customElement.js"></script>
    <script>
        var app;
        if (firebase.apps.length===0) {
            app=firebase.initializeApp({
                apiKey: "AIzaSyCnyVeuMNfIEPrB4GFnU3gepf6FMRctrWw",
                //authDomain: "PROJECT_class.firebaseapp.com",
                // The value of `databaseURL` depends on the location of the database
                databaseURL: "https://gp4e-6a225.firebaseio.com",
                projectclass: "gp4e-6a225",
                storageBucket: "gp4e-6a225.appspot.com",
                //messagingSenderclass: "SENDER_class",
                //appclass: "APP_class",
                // For Firebase JavaScript SDK v7.20.0 and later, `measurementclass` is an optional field
                //measurementclass: "G-MEASUREMENT_class",
            })
        } else {
            app = firebase.apps[0]
        }
        var user = app.auth().currentUser;
        console.log(user)    
        function getUrlVars()  {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++)
            {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        function selpl(player, i) {
            if (player["player"+(i+1)]!=null) {return player["player"+(i+1)]}
            else {return player[i]}
        }
        function colorToHex(c) {
            return '#'+ ('000000' + (c & 0xFFFFFF).toString(16)).slice(-6);
        }
        const db = firebase.firestore();
        var class=getUrlVars()["matchclass"];
        db.collection("matches").doc(class).onSnapshot((doc) => {
            var data = doc.data()
            console.log(data)
            var sets = data["sets"]
            var w1 = sets.filter(x=>x.score1>x.score2).length
            var w2 = sets.filter(x=>x.score2>x.score1).length
            var pl = data["players"]
            var pls = pl.length
            var team1="";
            var team2="";
            if (pls==4) {
                var pl1 = selpl(pl,0)
                var pl2 = selpl(pl,1)
                var pl3 = selpl(pl,2)
                var pl4 = selpl(pl,3)
                team1 = pl1["name"]+" "+pl3["name"]
                team2 = pl2["name"]+" "+pl4["name"]
            } else {
                var pl1 = selpl(pl,0)
                var pl2 = selpl(pl,1)
                team1 = pl1["name"]
                team2 = pl2["name"]
            }
            var color = [
                colorToHex(selpl(pl,0)["color"]),
                colorToHex(selpl(pl,1)["color"])
            ]
            document.getElementsByClassName("name1")[0].innerHTML=team1.toUpperCase()
            document.getElementsByClassName("name1")[0].style.backgroundColor = color[0]
            document.getElementsByClassName("name2")[0].innerHTML=team2.toUpperCase()
            document.getElementsByClassName("name2")[0].style.backgroundColor = color[1]

            document.getElementsByClassName("set1")[0].innerHTML=w1
            document.getElementsByClassName("set2")[0].innerHTML=w2

            document.getElementsByClassName("score1")[0].innerHTML=data["score1"]
            document.getElementsByClassName("score2")[0].innerHTML=data["score2"]
            
            document.getElementsByClassName("updates")[0].innerHTML=data["updates"]
        });
    </script>
</body>
</html>
